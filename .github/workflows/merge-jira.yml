on:
  # pull_request:
  #   types: [closed]
  push:
    branches:
      - master

name: Move Jira task to resolved when merge

jobs:
  build:
    runs-on: ubuntu-latest
    name: Move Jira task to resolved when merge
    steps:
      - name: Curl test
        id: create
        run: |
          res=$(curl -s -X POST \
            --url ${{ secrets.JIRA_BASE_URL }}/rest/api/3/issue \
            --user ${{ secrets.JIRA_USER_EMAIL }}:${{ secrets.JIRA_API_TOKEN }} \
            --header Accept:application/json \
            --header Content-Type:application/json \
            --data '{
              "fields": {
                  "summary": "Sample REST API.",
                  "project": {
                    "key": "NE"
                  },
                  "issuetype": {
                    "name": "Task"
                  },
                  "components": [
                    {
                      "name": "Cloud - Noodoe App"
                    }
                  ]
                }
              }')
          echo "::set-output name=key::$res | jq '.key' | sed 's/\"//g'"
          echo "::set-output name=id::$res | jq '.id' | sed 's/\"//g'"

      - name: Get id
        run: echo ${{ steps.create.outputs.id }}

      - name: Get key
        run: echo ${{ steps.create.outputs.key }}
      # - name: Login
      #   uses: atlassian/gajira-login@master
      #   env:
      #     JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
      #     JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}
      #     JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}
      # - name: Find in commit messages
      #   id: find
      #   uses: cybervoid/gajira-get-issue@master
      #   with:
      #     input-text: ${{ github.head_ref }}
      # - name: Transition issue
      #   uses: atlassian/gajira-transition@master
      #   with:
      #     issue: ${{ steps.find.outputs.issue }}
      #     transition: Resolve
